<html>
  <head>
    <style>
      body {
        font-family: Helvetica;
        line-height:1.3;
      }
      button {
        margin: 0.3em;
        padding: 1em 0.5em;
        vertical-align: bottom;
      }
      textarea{
        background-color:aliceblue;
      }
    </style>
    <script>window.LINQ = {}</script>
    <script src="browser/parser.js"></script>
    <script src="browser/transformer.js"></script>
    <script>
      onload = function(){
        var button = document.getElementById('test'),
            source = document.getElementById('source'),
            destination = document.getElementById('destination'),
            execute = document.getElementById('execute'),
            inline = document.getElementById('inline')

        button.onclick = function(){
          var sourceText = source.value;
          var finder = /(from((.|\s)*)select(.*))\n/gm;

          var output = sourceText;
          if(finder.test(sourceText)) output = sourceText.replace(finder, function(_, find){
            return LINQ.Transformer(LINQ.Parser(find)) + '\n'
          })
          destination.value = output;
        }
        execute.onclick = function(){
          try{
            eval(destination.value)
          }catch(O_o){
            alert('parsing error:\n' + O_o)
          }
        }
        inline.onclick = function(){
          source.value = "alert((\n  from x in [1,2,3]\n  select Math.pow(x, 3)\n).join('-'))"
        }
        where.onclick = function(){
          source.value = "alert((\n  from x in [1,2,3]\n  where x < 3 && x > 1\n  select x + 3\n).join(''))"
        }
        multipleFrom.onclick = function(){
          source.value = "alert((\n  from lower in 'xyz'.split('')\n  where lower !== 'x'\n  from upper in 'ABC'.split('')\n  from static in '123'.split('')\n  select JSON.stringify({ lower: lower, upper: upper, static: static })\n).join('\\n'))"
        }
      }
    </script>
  </head>
  <body>
    Source:<br />
    <textarea id=source rows="6" cols="50">var res = from x in [1,2,3]
      select x + 3
      alert(res.join('-'))
    </textarea>
    <button id=test >Transform</button><br/>
    <button id=inline>try inline linq (requires newline)</button>
    <button id=where>where</button>
    <button id=multipleFrom>multiple from</button>
    <hr />
    Linquified:<br />
    <textarea id=destination rows="6" cols="50"></textarea>
    <button id=execute>Try to execute</button>
  </body>
</html>
